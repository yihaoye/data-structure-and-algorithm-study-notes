目标#
设计一个高度可用（即可靠）、高度可扩展、完全去中心化的分布式键值存储。

什么是Dynamo？
Dynamo是亚马逊为其内部使用而开发的一种高可用键值存储。许多亚马逊服务，如购物车、畅销书列表、销售排名、产品目录等，只需要对数据进行主键访问。一个多表的关系型数据库系统对于这类服务来说是一种过度，同时也会限制可扩展性和可用性。Dynamo提供了一个灵活的设计，让应用程序选择他们想要的可用性和一致性水平。

背景#
Dynamo--不要与DynamoDB混淆，后者的设计灵感来自于Dynamo--是一个分布式键值存储系统，在大规模的情况下提供 "永远在线"（或高度可用）的体验。在CAP定理的术语中，Dynamo属于AP系统的范畴（即可用和分区容忍），并且是以牺牲强一致性为代价来设计高可用性和分区容忍。将Dynamo设计成一个高可用系统的主要动机是观察到系统的可用性与所服务的客户数量直接相关。因此，主要目标是系统即使不完善，也应该对客户可用，因为它能带来更多的客户满意度。另一方面，不一致的问题可以在后台解决，而且大多数时候客户不会注意到它们。从这个核心原则出发，Dynamo积极地对可用性进行了优化。

Dynamo的设计具有很大的影响力，因为它启发了许多NoSQL数据库，如Cassandra、Riak和Voldemort--更不用说亚马逊自己的DynamoDB。

设计目标#
如上所述，Dynamo的主要目标是高度可用。下面是其其他设计目标的总结。

可扩展性。该系统应该是高度可扩展的。我们应该能够把一台机器扔进系统中，看到相应的改进。
分散的。为了避免单点故障和性能瓶颈，不应该有任何中央/领导的过程。
最终一致的。数据可以被乐观地复制，成为最终一致的。这意味着，与其为确保整个系统的数据正确性而产生写入时间成本（即强一致性），不如在其他时间（例如，在读取过程中）解决不一致的问题。最终的一致性被用来实现高可用性。

![](./Dynamo%20High%20Level.png)  
分布式键值存储的高层次视图
Dynamo的使用案例#
默认情况下，Dynamo是一个最终一致的数据库。因此，任何不关心强一致性的应用都可以利用Dynamo。尽管Dynamo可以支持强一致性，但它会对性能产生影响。因此，如果强一致性是一个应用程序的要求，那么Dynamo可能不是一个好的选择。

Dynamo在亚马逊被用来管理那些对可靠性要求非常高的服务，并且需要严格控制可用性、一致性、成本效益和性能之间的权衡。亚马逊的平台有非常多样化的应用，有不同的存储要求。许多应用选择Dynamo是因为它可以灵活地选择适当的权衡，以最经济的方式实现高可用性和保证性能。

亚马逊平台上的许多服务只要求对数据存储的主键访问。对于这样的服务，使用关系型数据库的常见模式会导致效率低下，并限制可扩展性和可用性。Dynamo提供了一个简单的只有主键的接口，以满足这些应用程序的要求。

系统应用程序接口#
Dynamo客户端使用put()和get()操作来写入和读取对应于指定键的数据。这个键唯一地标识了一个对象。

get(key)。get操作找到与给定键相关的对象所在的节点，并返回一个单一的对象或一个具有冲突版本的对象列表以及一个上下文。上下文包含了关于对象的编码元数据，这些元数据对调用者没有意义，包括对象的版本等信息（下面会有更多的介绍）。

put(key, context, object)。put操作找到与给定键相关的对象应该被存储的节点，并将给定的对象写到磁盘上。上下文是一个值，通过get操作返回，然后通过put操作送回。上下文总是与对象一起存储，并像一个cookie一样用来验证在投放请求中提供的对象的有效性。

Dynamo将对象和密钥都视为一个任意的字节数组（通常小于1MB）。它在密钥上应用MD5散列算法，生成一个128位的标识符，用来确定负责提供密钥的存储节点。



在高层次上，Dynamo是一个分布式哈希表（DHT），它在集群中进行复制，以实现高可用性和容错。

介绍。Dynamo的架构#
Dynamo的架构可以概括为以下几点（我们将在下面的课程中详细讨论所有这些概念）。

数据分布#
Dynamo使用一致哈希法在节点间分配数据。一致性散列也使得从Dynamo集群中添加或删除节点变得容易。

数据复制和一致性#
数据是乐观地复制的，即Dynamo提供最终的一致性。

处理临时故障#
为了处理临时故障，Dynamo将数据复制到系统中其他节点的马虎法定人数，而不是严格的多数法定人数。

节点间通信和故障检测#
Dynamo的节点使用gossip协议来跟踪集群状态。

高可用性#
Dynamo通过使用暗示交接使系统 "永远可写"（或高可用性）。

冲突解决和处理永久性故障#
由于没有写入时间保证节点在数值上达成一致，Dynamo使用其他机制来解决潜在冲突。

使用矢量时钟来跟踪价值历史，并在读取时调和不同的历史。
在后台，dynamo使用像Merkle树这样的反熵机制来处理永久性故障。
让我们逐一讨论这些概念。




