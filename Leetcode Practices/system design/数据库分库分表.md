# 数据库分库分表
1. 一开始系统使用一个物理机（服务器）存储多个 MySQL 业务数据库（与 Table 同一级别概念，是一个 MySQL 程序里的多个 库 Databases，比如订单库、用户库、促销库等等）。
2. 主从数据库（读写分离）。
3. 若即使已经读写分离的情况下单个物理机也开始不堪重负，则可以使用多个物理机，每个物理机存储一个 MySQL 业务数据库（比如订单库）。然后这几个物理机组成完整的数据集（数据一致），这群物理机称之为一个 MySQL 节点。
4. 若单个物理机即使只负责单个业务数据库也不堪重负时，比如用户海量时对订单库的请求特别频繁。
   1. 则可以用单个 MySQL 节点（多个物理机）负责单个业务数据库。
   2. 然后若是单个库还是太大，这时要看是因为表多而导致数据多，还是因为单张表里面的数据多。如果是因为表多而数据多，使用垂直切分，根据业务切分成不同的库并分离到不同节点。如果是因为单张表的数据量太大，这时要用水平切分，即把表的数据按某种规则切分成多张表，甚至多个库上的多张表，即后面第 5 步的分表。
   3. 分库分表的顺序应该是先垂直分，后水平分。因为垂直分更简单，更符合人们处理现实世界问题的方式。
5. 分表（比如哈希分表）。

## 分库分表后面临的问题
* 事务支持 - 分库分表后，就成了分布式事务了。如果依赖数据库本身的分布式事务管理功能去执行事务，将付出高昂的性能代价；如果由应用程序去协助控制，形成程序逻辑上的事务，又会造成编程方面的负担。
* 多库结果集合并（group by，order by）
* 跨库 join - 分库分表后表之间的关联操作将受到限制，无法 join 位于不同分库的表，也无法 join 分表粒度不同的表，结果原本一次查询能够完成的业务，可能需要多次查询才能完成。粗略的解决方法：
  * 全局表：基础数据，所有库都拷贝一份。
  * 字段冗余：这样有些字段就不用 join 去查询了。
  * 系统层组装：分别查询出所有，然后组装起来，较复杂。

参考：
https://www.youtube.com/watch?v=pn2j88PEW0Y  
https://juejin.cn/post/6844903648670007310  
