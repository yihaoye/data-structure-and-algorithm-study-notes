# 简介
评估构建端到端机器学习解决方案包括：
* 设计可扩展的数据管道
* 选择合适的算法和模型
* 数据质量处理和预处理
* 确保模型部署和监控
* 应对延迟、可扩展性和可复现性等挑战

## 约束 
通过机器学习来实现核心业务功能，需要：
* 定义机器学习目标 - 业务⽬标可能是将销售额提⾼ 20% 或改善⽤户留存率。但⽬标可能没有明确定义，不能仅仅通过告诉模型 “提⾼ 20% 的销售额” 来训练它。为了让机器学习系统解决任务，需要将业务⽬标转化为明确的机器学习⽬标。⼀个好的机器学习⽬标是机器学习模型能够解决的⽬标。
* 指定系统的输入和输出（比如输入文本还是图片，输出布尔值还是连续数值）
  * 分类模型 - 分类是预测离散类别标签的任务，例如预测输⼊图像是否应该被分类为狗或猫。分类模型可以分为 2 组：⼆分类模型、多分类模型。
  * 回归模型 - 回归是预测连续数值的任务，例如预测房价或股票价格。回归模型可以分为线性回归和非线性回归。回归的核心思想是拟合（Fitting），比如坐标轴上散落着很多点，回归模型就是尝试画出一条最能代表这些点趋势的线。线性回归（Linear Regression）：假设关系是一条直线。方程类似于 y = ax + b。比如：工龄越长，工资越高。非线性回归：关系可能是曲线（比如指数增长）。
* 选择正确的机器学习类别（保证机器学习模型与业务目标保持一致）
  * 监督学习 - 通过使⽤带标签的数据集来学习任务。实际上，许多问题都属于这⼀类别，因为从带标签的数据中学习通常能得到更好的结果。
  * 无监督学习 - 通过处理不含正确答案的数据来进⾏预测。⽆监督学习模型的⽬标是从数据中发现潜在结构。
  * 强化学习 - 计算机智能体通过与环境的反复试错互动来学习执⾏任务。例如，可以训练机器⼈在房间中⾏⾛，也可以通过强化学习让 AlphaGo 这样的程序与对⼿在围棋中竞技。

### 数据相关
1. 数据准备 - 数据源 -> 数据工程 -> 特征工程 -> 预备特征
2. 数据工程 - 是设计和构建⽤于收集、存储、检索和处理数据的管道的实践。
3. 数据来源 - 机器学习系统可以处理来⾃许多不同来源的数据。了解数据来源是回答许多背景问题的好⽅法，这些问题可能包括：谁收集的数据？数据有多⼲净？数据来源是否可信？数据是⽤户⽣成的还是系统⽣成的？
4. 数据存储 - 数据库
   1. ETL（提取、转换、加载）
   2. 数据类型 - 结构化数据、非结构化数据、半结构化数据
   3. 数值数据
   4. 类别数据
5. 特征⼯程 - 包括两个过程。选择合适的特征是开发和训练机器学习模型时最重要的决策之⼀。选择最有价值的特征⾄关重要，⽽这⼀特征⼯程过程需要领域专家的知识，同时也⾼度依赖于具体任务。
   1. 使⽤领域知识从原始数据中选择和提取具有预测能⼒的特征
   2. 将预测特征转换为模型可⽤的格式
6. 特征工程操作 - ⼀旦选择了预测特征，就需要通过特征⼯程操作将它们转换为合适的格式。通常，⼀些选定的特征并不是模型可以直接使⽤的格式。特征⼯程操作可以将这些特征转换为模型可使⽤的格式。技术包括处理缺失值、缩放值有偏分布的数据，以及编码类别特征。
   1. 处理缺失值 - 没有⼀种处理缺失值的⽅法是完美的，每种⽅法都有其权衡。
      1. 删除 - 删除可以分为⾏删除和列删除。在列删除中，如果某个特征的缺失值太多，可以移除整个表示该特征的列。在⾏删除中，如果某个数据点有许多缺失值可以移除这⼀行。
      2. 填补 - ⽤默认值、均值、中位数或众数（最常⻅的值）填补缺失值。
   2. 特征缩放 - 是指将特征缩放到标准范围和分布的过程。当数据集中的特征处于不同的范围时，许多机器学习模型在学习任务时会遇到困难。例如，年龄和收⼊这样的特征可能有不同的取值范围。此外，当⼀个特征具有偏态分布时，⼀些模型在学习任务时也可能遇到困难。
      1. 归⼀化（最⼩-最⼤缩放）- 在这种⽅法中，特征被缩放到所有值都在［0，1］的范围内。归⼀化不会改变特征的分布，如果要将特征的分布更改为标准分布，则使⽤标准化。
      2. 标准化（Z-score 归⼀化）- 标准化是将特征的分布更改为均值 0，标准差为 1 的过程。
      3. 对数缩放 - 为了减⼩特征的偏度，可以使⽤⼀种称为对数缩放的常⽤技术。
   3. 离散化（分箱）- 离散化是将连续特征转换为类别特征的过程。
   4. 码类别特征 - 在⼤多数机器学习模型中，所有的输入和输出都必须是数值型的。这意味着如果某个特征是类别型的，应该在将其传递给模型之前将其编码为数值。将类别特征转换为数值表示的三种常⻅⽅法是整数编码、独热编码和嵌⼈学习。
      1. 紧数编码 - 为每个唯⼀的类别值分配⼀个整数值。
      2. 独热编码 - 会为每个唯⼀值创建⼀个新的⼆进制特征。
      3. 嵌入学习 - 是⼀种将类别特征映射到 N 维向量的⽅法。当特征可能取的唯⼀值数量⾮常⼤时，这种⽅法很有⽤。在这种悄况下，独热编码不是⼀个好的选择，因为它会导致⾮常⼤的向量⼤⼩。


## 机器学习系统生命周期
至关重要，包括数据收集、部署和维护。核心原则包括：
1. 以数据为中心的方法：优先考虑高质量、有代表性的数据收集和预处理。
2. 模块化设计：将系统组件分离，便于更新或更换。
3. 自动化：利用自动化进行培训、验证、部署和监控。
4. 可扩展性：设计能够处理不断增长的数据量和用户需求的系统。
5. 稳健的监控：实施持续监控以检测模型漂移和数据异常。

提倡务实的做法，即系统设计是迭代的，强调反馈循环和持续改进。

构建可扩展分布式架构机器学习系统：  
1. 分布式数据处理：使用 Spark 或 Flink 等框架进行大规模数据处理。
2. 模型服务基础设施：构建可扩展的 API 和服务层，以支持实时推理。
3. 自动化和 CI/CD：自动化模型训练、测试和部署管道，以加速迭代。
4. 资源优化：高效利用硬件资源，包括 GPU 和 CPU 集群。
5. 故障转移和冗余：通过备份系统和优雅降级策略确保系统弹性。

强调基于现实世界约束和部署环境的实用架构决策。

## 机器学习系统设计的核心组成部分
数据收集与存储  
高效的机器学习系统始于高质量的数据。关键考虑因素包括：
* 数据来源和集成方法
* 数据清洗和验证流程
* 存储解决方案，例如数据湖、数据仓库或分布式文件系统
* 处理数据版本控制和血缘关系

数据处理和特征工程  
将原始数据转换为适合建模的特征：
1. 数据归一化和缩放
2. 特征提取与选择
3. 处理缺失或不一致的数据
4. 自动化特征工程流程

模型开发与培训  
模型设计和训练包括：
* 选择合适的算法（例如，深度学习、梯度提升）
* 超参数调优与验证
* 针对大型数据集的分布式系统训练
* 实施提前停止和正则化

模型部署和服务  
主要方面包括：
1. 使用 Docker 或 Kubernetes 进行容器化
2. 用于推理的 API 端点
3. 延迟和吞吐量优化
4. 模型版本控制和回滚策略

监控和维护  
确保系统长期保持健康和性能良好：
* 跟踪准确率、延迟和吞吐量等指标
* 检测模型漂移和数据分布变化
* 根据需要自动重新训练和更新模型
* 异常日志记录和警报系统

## 设计原则和最佳实践
可扩展性和效率  
* 使用分布式处理框架处理大规模数据
* 优化资源利用
* 实现缓存和批量处理

可复现性和版本控制
* 维护代码和数据版本控制
* 使用 MLflow 等实验跟踪工具
* 实现流程自动化，以获得一致的结果

自动化和持续集成/持续部署 (CI/CD)
* 自动化数据摄取、模型训练、测试和部署
* 使用 CI/CD 流水线来减少人为错误
* 确保快速迭代和反馈

稳健性和可靠性
* 容错设计
* 实施冗余和备用机制
* 定期测试极端情况和故障模式

## 常见挑战及应对方法
数据质量和偏差
* 定期审核数据是否存在偏差
* 整合多种数据来源
* 在模型评估过程中使用公平性指标

模型漂移和数据偏移
* 持续监测模型性能
* 实施自动化再培训流程
* 适用时可使用在线学习

延迟和实时处理
* 优化模型推理速度
* 使用硬件加速器，例如 GPU
* 模型复杂性和速度之间的平衡

部署和可扩展性
* 容器化模型以实现可移植性
* 使用托管云服务进行扩展
* 面向水平扩展的设计
