# 分桶法（分块）
当面对大量数据，需要进行某种操作时，分桶法（Bucketing）或分桶/分块思想是一种有效的技术。它的基本思想是将数据分割成不同的“桶”或“区间”，然后在每个桶中执行操作，最后将结果合并起来。  

分桶法在各种领域都有应用，比如数据处理、算法优化、统计分析等等。以下是一些分桶法的常见应用：
1. **数据分布统计：** 将数据分成不同的桶，然后统计每个桶中的数据数量，可以帮助我们更好地了解数据的分布情况。
2. **数据压缩：** 在数据压缩领域，分桶法可以将数据分成多个桶，然后对每个桶中的数据进行压缩，最后将压缩后的数据合并起来。
3. **排序：** 在排序算法中，分桶法可以将数据分成多个桶，然后对每个桶中的数据进行排序，最后将每个桶中的数据按顺序合并起来，从而实现整体的排序。
4. **计算：** 在一些计算问题中，分桶法可以将数据分成多个桶，然后对每个桶中的数据进行计算，最后将计算结果合并起来，从而得到最终的结果。

分桶法的优势在于可以将大规模的问题分解成多个小问题，从而提高计算效率。它在处理大数据量、优化算法、并行计算等方面有着重要的应用价值。  

By ChatGPT  

现实系统里，如 HyperLogLog 采用了分桶法进行优化。  

## 分桶策略
分桶的合理性取决于问题的性质以及数据的分布情况。不同的问题可能需要不同的分桶策略来达到最佳效果。以下是一些常见的分桶策略：

1. **均匀分桶：** 将数据均匀地分成固定数量的桶。这种方法适用于数据分布相对均匀的情况，能够有效地利用桶来优化查询。
2. **范围分桶：** 根据数据的范围将数据分成不同的桶。例如，将数据按照值的大小范围进行分桶，每个桶内的数据都在一个特定的范围内。这种方法适用于需要区间查询的问题。
3. **哈希分桶：** 使用哈希函数将数据映射到不同的桶中。这种方法在需要根据某种特定规则对数据进行分类的情况下很有用。
4. **平方分割：** 将数据分成块，每个块的大小为总数据量的平方根。这种方法在某些特定问题中可以帮助优化区间查询和修改操作。
5. **负载均衡分桶：** 根据数据的负载情况将数据分成桶，以便均衡地分配查询和操作的负载。

选择合适的分桶策略需要考虑问题的性质、数据分布以及具体的操作需求。通常情况下，分桶策略的选择会影响算法的性能，因此需要根据具体情况进行权衡和实验。

## 分桶法和分治法区别
分桶法和分治法有些相似，但它们是不同的概念。  

1. **分桶法**：分桶法是一种数据处理技术，通常用于优化某些特定类型的查询操作。它将数据分成多个桶（或块），在每个桶内进行预处理，以便能够高效地支持查询操作。分桶法的一个常见应用是范围查询，其中我们将数据分成桶，在每个桶内计算部分和，然后根据查询的范围和桶的分布来计算总和。分桶法在解决一些数据处理问题时非常有用，例如动态数组修改、区间查询等。
2. **分治法**：分治法是一种解决问题的算法设计策略。它将问题分解成更小的子问题，然后将子问题逐个解决，最后将它们的解合并起来以得到原始问题的解。分治法的典型应用包括快速排序和归并排序等。分治法常常用于解决复杂的计算问题，通过将问题划分为可管理的部分来简化解决过程。

尽管分桶法和分治法都涉及将问题分解成更小的部分，但它们的主要区别在于应用领域和目标。分桶法更侧重于数据处理和查询优化，而分治法更侧重于算法设计和解决问题的方法。

### 合并排序与分桶法
合并排序（Merge Sort）使用了类似分桶法的思想，尽管它通常不被严格称为分桶法，但它的思想与分桶法有些相似。  
合并排序将一个大的序列分割成较小的子序列，然后对这些子序列进行排序，最后将排序后的子序列合并起来得到整体有序的序列。在分割和合并的过程中，合并排序使用了“分而治之”的策略，将问题分解成更小的部分并逐步解决。  
尽管合并排序的主要目的是进行排序，而不是区间查询等特定操作，但它的思想与分桶法和分治法都有一些共通之处。  
其实真更接近分桶法的排序算法是桶排序。  

## 分桶法与线段树的异同
分桶法和线段树都是一种处理区间查询和修改操作的数据结构，但它们的实现和应用有一些异同点。

**共同点：**
- 都可以用于解决范围查询和修改问题，例如区间求和、区间最大/最小值等。
- 都可以用于优化对大量区间的查询和修改操作，从而减少时间复杂度。

**分桶法：**
- 分桶法将数据分成若干个桶，每个桶中包含一部分数据，对每个桶预处理得到一些信息（例如区间和、区间最大/最小值等）。
- 分桶法适用于数据范围较大，但是每个区间内的数据较少的情况。分桶法的优势在于它可以通过预处理在一定程度上减少每个区间的查询和修改的时间复杂度。
- 分桶法可能需要额外的空间来存储每个桶的预处理信息。

**线段树：**
- 线段树是一种二叉树数据结构，每个节点表示一个区间，通过节点间的关系构建整体区间的信息（例如区间和、区间最大/最小值等）。
- 线段树适用于数据范围较大，每个区间内的数据较多的情况。线段树的优势在于它能够高效地进行区间查询和修改操作，且空间复杂度相对较小。
- 线段树的构建和查询操作可能需要递归，但可以通过优化（例如懒惰标记）来提高性能。

**异同点总结：**
- 分桶法和线段树都是用于处理区间查询和修改问题的数据结构。
- 分桶法将数据分成桶，每个桶预处理一些信息，适用于每个区间内的数据较少的情况。
- 线段树是一种二叉树结构，通过节点间的关系构建区间信息，适用于每个区间内的数据较多的情况。
- 分桶法可能需要额外的空间来存储桶的预处理信息，而线段树的空间开销相对较小。
- 根据具体问题的性质和数据规模，选择合适的数据结构来解决问题。

## 例题
* [LC Q901](../Leetcode%20Practices/algorithms/medium/901%20Online%20Stock%20Span.java)
* [其他](https://chengzhaoxi.xyz/869e0e25.html)

平方桶  
平方分桶是把排成一排的 n 个元素每 √n 个分在一个桶内进行维护的方法的统称。这样的分桶方法可以使对区间的操作的复杂度降至 O(√n)。  
在 LC 1157 - 分块查找表，无修改区间众数中解决了一个无修改的区间众数的问题，基于平方分桶的分块查找表是众多方法中比较容易实现的一种。  

频数桶  
将 key 的查询次数作为给 key 分桶的依据。在 LC 1224 - 最大相等频率中解决了一个基于频数分桶的问题，并且对基于数组的桶和基于链表的桶都做了实现。  
LC 460 - LFU，LC 895 - 最大频率栈和 LC 432 - 全 O(1) 的数据结构是设计带有频数分桶需求的数据结构的问题。它们的基础结构都可以抽象为邻接表。  

斜率桶  
在计算几何问题中，很多时候要把直线按照斜率排序后处理，但是斜率相同的情况又有特殊的处理逻辑。这时候需要把直线按照斜率分桶处理，实现桶的数据结构一般是 TreeMap。  
LC 149 - 直线上最多的点数  
LCP 37 - 最小矩形面积  

哈希桶  
用哈希函数对不同的 key 求哈希值，可能会出现冲突的情况。那么对于同一哈希值的不同 key 可以通过桶的方式维护，开散列表就是这么做的。[【模板】哈希集合](https://chengzhaoxi.xyz/850f2080.html) 和 [【模板】无重哈希映射](https://chengzhaoxi.xyz/e9f99386.html) 这两篇文章在开散列表的基础上实现了有重和无重的哈希集合和无重哈希映射。  

多维桶  
对 key 有多个分桶条件。  
LC 527 - 单词缩写  
LC 939、963 - 最小面积矩形  
LC 149 - 自定义哈希函数&RANSAC算法  
